# üìò –ì–ê–õ–Ø –ë–ê–õ–£–í–ê–ù–ê - Production Hub (–¢–µ—Ö–Ω—ñ—á–Ω–∞ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è)

## 1. –û–≥–ª—è–¥ –ü—Ä–æ–µ–∫—Ç—É
**Production Hub** ‚Äî —Ü–µ –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ –¥–ª—è —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–æ–º —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∑–∞–ª–∏—à–∫—ñ–≤ —É –º–µ—Ä–µ–∂—ñ –º–∞–≥–∞–∑–∏–Ω—ñ–≤ "–ì–∞–ª—è –ë–∞–ª—É–≤–∞–Ω–∞". –°–∏—Å—Ç–µ–º–∞ –Ω–∞–¥–∞—î –∫–µ—Ä—ñ–≤–Ω–∏–∫—É –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ —Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—É –¥–æ—Å—Ç—É–ø –¥–æ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ, –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –¥–µ—Ñ—ñ—Ü–∏—Ç —Ç–æ–≤–∞—Ä—ñ–≤ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –≤–∏—Ä–æ–±–Ω–∏—á—ñ –ø–æ—Ç—É–∂–Ω–æ—Å—Ç—ñ.

### üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—á–Ω–∏–π –°—Ç–µ–∫
*   **Framework:** [Next.js 16 (App Router)](https://nextjs.org/)
*   **–ú–æ–≤–∞:** TypeScript
*   **–°—Ç–∏–ª—ñ–∑–∞—Ü—ñ—è:** Tailwind CSS v4 + Framer Motion (–∞–Ω—ñ–º–∞—Ü—ñ—ó)
*   **–ë–∞–∑–∞ –î–∞–Ω–∏—Ö & Auth:** [Supabase](https://supabase.com/) (PostgreSQL)
*   **State Management:** React Context (UI) + SWR (Server State)
*   **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:** Playwright (E2E)
*   **Icons:** Lucide React

---

## 2. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç—É

–ü—Ä–æ–µ–∫—Ç –ø–æ–±—É–¥–æ–≤–∞–Ω–∏–π —è–∫ **Serverless Monolith** –Ω–∞ –±–∞–∑—ñ Next.js App Router.

### üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü–∞–ø–æ–∫
```
/src
‚îú‚îÄ‚îÄ /app                 # App Router (—Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–∞ API)
‚îÇ   ‚îú‚îÄ‚îÄ /api/graviton    # Backend API endpoints (Next.js Servlerless Functions)
‚îÇ   ‚îú‚îÄ‚îÄ /bi              # –ì–æ–ª–æ–≤–Ω–∏–π –¥–∞—à–±–æ—Ä–¥ (Business Intelligence)
‚îÇ   ‚îú‚îÄ‚îÄ /login           # –°—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—Ö–æ–¥—É
‚îÇ   ‚îî‚îÄ‚îÄ layout.tsx       # Root layout (Metadata, Fonts)
‚îú‚îÄ‚îÄ /components          # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx       # Sidebar, Global Layout wrapper
‚îÇ   ‚îú‚îÄ‚îÄ BIPowerMatrix.tsx # –û—Å–Ω–æ–≤–Ω–∞ –º–∞—Ç—Ä–∏—Ü—è –∑–∞–ª–∏—à–∫—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ /context             # React Context (StoreContext)
‚îú‚îÄ‚îÄ /lib                 # –£—Ç–∏–ª—ñ—Ç–∏ (Supabase client, Logger, Helpers)
‚îú‚îÄ‚îÄ /types               # TypeScript —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ (DB types, Props)
‚îú‚îÄ‚îÄ /utils               # Server/Client utilities (Supabase SSR)
‚îî‚îÄ‚îÄ middleware.ts        # Middleware –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É —Ä–æ—É—Ç—ñ–≤
```

---

## 3. –ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –ê–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è

–°–∏—Å—Ç–µ–º–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≥—ñ–±—Ä–∏–¥–Ω—É –º–æ–¥–µ–ª—å –±–µ–∑–ø–µ–∫–∏:
1.  **Supabase Auth:** –û—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó.
2.  **Next.js Middleware (`middleware.ts`):** –ü–µ—Ä–µ—Ö–æ–ø–ª—é—î –∫–æ–∂–µ–Ω –∑–∞–ø–∏—Ç.
    *   –ó–∞—Ö–∏—â–∞—î —Ä–æ—É—Ç–∏ `/bi` —Ç–∞ `/production`.
    *   –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—î –Ω–µ–∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ `/login`.
    *   *–¢–∏–º—á–∞—Å–æ–≤–æ:* –ü—ñ–¥—Ç—Ä–∏–º—É—î `bypass_auth` cookie –¥–ª—è dev-–¥–æ—Å—Ç—É–ø—É.
3.  **API Security:** –í—Å—ñ —Ä–æ—É—Ç–∏ –≤ `/api/graviton/*` –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å –Ω–∞—è–≤–Ω—ñ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—ó —Å–µ—Å—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ admin-cookie –ø–µ—Ä–µ–¥ –≤–∏–¥–∞—á–µ—é –¥–∞–Ω–∏—Ö.

---

## 4. –ë–∞–∑–∞ –î–∞–Ω–∏—Ö (Supabase)

–î–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ PostgreSQL. –û—Å–Ω–æ–≤–Ω—ñ —Ç–∞–±–ª–∏—Ü—ñ:

### `dashboard_deficit` (VIEW)
–ó—Ä—ñ–∑ –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø–æ—Ç–æ—á–Ω—ñ –∑–∞–ª–∏—à–∫–∏ —Ç–∞ –¥–µ—Ñ—ñ—Ü–∏—Ç.
*   **Schema:** `public` (–¥–æ—Å—Ç—É–ø–Ω–∞ –±–µ–∑ –ø—Ä–µ—Ñ—ñ–∫—Å—ñ–≤).
*   `id`, `created_at`
*   `–Ω–∞–∑–≤–∞_–º–∞–≥–∞–∑–∏–Ω—É`, `–∫–æ–¥_–º–∞–≥–∞–∑–∏–Ω—É`
*   `–Ω–∞–∑–≤–∞_–ø—Ä–æ–¥—É–∫—Ç—É`, `recommended_kg` (—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–µ–±–∞ –∑—Ä–æ–±–∏—Ç–∏)
*   `priority` (1=–ö—Ä–∏—Ç–∏—á–Ω–æ, 2=–í–∏—Å–æ–∫–∏–π, 3=–†–µ–∑–µ—Ä–≤)

### `audit_logs`
–õ–æ–≥—É–≤–∞–Ω–Ω—è –¥—ñ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ —Ç–∞ —Å–∏—Å—Ç–µ–º–∏.
*   `action` (–Ω–∞–ø—Ä. 'VIEW_DEFICIT', 'LOGIN')
*   `user_id`, `ip_address`, `user_agent`

*–ú—ñ–≥—Ä–∞—Ü—ñ—ó –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –≤ –ø–∞–ø—Ü—ñ `supabase/migrations`.*

---

## 5. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –ó–∞–ø—É—Å–∫ (Local Development)

### –ü–µ—Ä–µ–¥—É–º–æ–≤–∏
*   Node.js 18+
*   npm

### 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
```bash
npm install
```

### 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö –æ—Ç–æ—á–µ–Ω–Ω—è (.env.local)
–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–µ–Ω—ñ:
```env
NEXT_PUBLIC_SUPABASE_URL=your_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
```

### 3. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–æ–∑—Ä–æ–±–∫–∏
```bash
npm run dev
```
–í—ñ–¥–∫—Ä–∏–π—Ç–µ [http://localhost:3000](http://localhost:3000).

---

## 6. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è (E2E)

–ü—Ä–æ–µ–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **Playwright** –¥–ª—è –Ω–∞—Å–∫—Ä—ñ–∑–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Å—ñ —Ç–µ—Å—Ç–∏ (headless mode)
npx playwright test

# –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ UI —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º
npx playwright test --ui
```

*–û—Å–Ω–æ–≤–Ω–∏–π —Ç–µ—Å—Ç:* `tests/e2e/auth.spec.ts` (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞—Ö–∏—Å—Ç—É —Ä–æ—É—Ç—ñ–≤ —Ç–∞ —Ä–µ–¥—ñ—Ä–µ–∫—Ç—ñ–≤).

---

## 7. –î–µ–ø–ª–æ–π

–ü—Ä–æ–µ–∫—Ç –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è –¥–µ–ø–ª–æ—é –Ω–∞ **Vercel**.
1.  –ü—ñ–¥–∫–ª—é—á—ñ—Ç—å GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –¥–æ Vercel.
2.  –î–æ–¥–∞–π—Ç–µ Environment Variables (Supabase URL & Key) –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –ø—Ä–æ–µ–∫—Ç—É Vercel.
3.  –î–µ–ø–ª–æ–π –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø—É—à—ñ –≤ `main`.

---

## 8. API Reference

### `GET /api/graviton/deficit`
–ü–æ–≤–µ—Ä—Ç–∞—î –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–µ—Ñ—ñ—Ü–∏—Ç–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤.
*   **Auth:** Required
*   **Response:** Array of `SupabaseDeficitRow` with mapped priorities.

### `GET /api/graviton/metrics`
–ü–æ–≤–µ—Ä—Ç–∞—î –∫–ª—é—á–æ–≤—ñ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è KPI –∫–∞—Ä—Ç–æ–∫.
*   **Auth:** Required
*   **Response:** `{ shopLoad, criticalSKU, aiEfficiency, ... }`

---

## 9. –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å (Performance Audit)
*–°—Ç–∞–Ω–æ–º –Ω–∞ –õ—é—Ç–∏–π 2026*

*   **Load Testing:** 100% –∞–ø—Ç–∞–π–º –ø—Ä–∏ 100 –æ–¥–Ω–æ—á–∞—Å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞—Ö.
*   **Frontend Build:** –ë–µ–∑ –ø–æ–º–∏–ª–æ–∫ (Type safety enforced).
*   **API Latency:** ~200ms (–æ–±–º–µ–∂–µ–Ω–æ –º–µ—Ä–µ–∂–µ–≤–æ—é –∑–∞—Ç—Ä–∏–º–∫–æ—é –¥–æ VPS).

## 10. Troubleshooting (–í–∏—Ä—ñ—à–µ–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º)

### üî¥ 500 Internal Server Error (API)
–Ø–∫—â–æ API –ø–æ–≤–µ—Ä—Ç–∞—î 500 –∑—ñ —Å–ª–æ–≤–∞–º–∏ `relation "..." does not exist`:
1.  –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å—Ö–µ–º–∏ –≤ `src/lib/supabase.ts` —Ç–∞ `server.ts`.
2.  **–í–∞–∂–ª–∏–≤–æ:** –ü—Ä–æ–µ–∫—Ç –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –Ω–∞ —Ä–æ–±–æ—Ç—É –∑—ñ —Å—Ö–µ–º–æ—é `public` (–¥–µ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è `dashboard_deficit`).
3.  –ù–µ –¥–æ–¥–∞–≤–∞–π—Ç–µ `db: { schema: 'graviton' }`, —è–∫—â–æ —É –≤–∞—Å –Ω–µ–º–∞—î –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ—ó —Å—Ö–µ–º–∏.

### üî¥ Build Error: "Type ... is not assignable to type number"
–í–∏–Ω–∏–∫–∞—î, —è–∫—â–æ –≤ `StoreContext` `currentCapacity` –¥–æ—Ä—ñ–≤–Ω—é—î `null`.
*   **–†—ñ—à–µ–Ω–Ω—è:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ `Metrics | null` —Ç–∏–ø–∏ –∞–±–æ fallback –∑–Ω–∞—á–µ–Ω–Ω—è `(value || 0)` –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö.
